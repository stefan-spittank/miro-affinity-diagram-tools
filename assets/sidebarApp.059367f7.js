var L=Object.defineProperty,B=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var P=(r,t,n)=>t in r?L(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,b=(r,t)=>{for(var n in t||(t={}))H.call(t,n)&&P(r,n,t[n]);if(I)for(var n of I(t))Y.call(t,n)&&P(r,n,t[n]);return r},h=(r,t)=>B(r,W(t));import{g as v}from"./miroInstance.b01b0cd8.js";import{r as e,s as p,R as j}from"./vendor.836cfe6a.js";import{w as E,i as y,g as z,a as g}from"./interviewStickerTools.3e51b9ff.js";const _=({setView:r})=>{const t=v();return e.exports.createElement(e.exports.Fragment,null,e.exports.createElement("h1",null,"Affinity Diagram Tools"),e.exports.createElement("h2",null,"Import notes"),e.exports.createElement("p",{className:"p-medium"},"Paste the raw text notes in the importer and the plugin will create a sticker for each paragraph."),e.exports.createElement("button",{className:"button button-primary",onClick:async()=>{await t.board.ui.openModal("src/ImportMinutes/ImportMinutes.html",{fullscreen:!0})}},"Import notes"),e.exports.createElement("h2",null,"Review the orginal notes"),e.exports.createElement("p",{className:"p-medium"},"You can safely modify the sticker text (e.g. for brevity) while the plugin makes sure, the original text is still available to you. You can review the original notes for the selected stickers any time."),e.exports.createElement("button",{className:"button button-secondary",onClick:()=>{r("ShowMinutesMetadata")}},"View original notes"),e.exports.createElement("h2",null,"Create random stacks"),e.exports.createElement("p",{className:"p-medium"},"Split the stickers into random stacks for the interpretation session."),e.exports.createElement("button",{className:"button button-secondary",onClick:()=>{r("CreateRandomStacks")}},"Create random stacks"))};function G(r){return Math.floor(Math.random()*r)}const K=(r,t,n)=>{const o=Math.ceil(r.length/t),s=Math.min(n||Number.MAX_SAFE_INTEGER,o),i=[];for(let c=0;c<t;++c){const a=[];for(let l=0;l<s&&r.length>0;++l){const u=G(r.length),d=r.splice(u,1)[0];a.push(d)}i.push({elements:a})}return i},V=(r,t,n)=>{const o=r.reduce((c,a)=>c+a.elements.length,0),s=Math.ceil(o/r.length),i=Math.ceil(Math.sqrt(s));return r.flatMap((c,a)=>{const l=Math.ceil(Math.sqrt(c.elements.length)),u=a*E,k=i*a*E+u;return c.elements.map((f,x)=>{const S=Math.floor(x/l),N=x%l;return h(b({},f),{x:t+N*E+k,y:n+S*E})})})},A=p.a`
  font-family: var(--body-font);
  font-size: var(--font-size-small);
  text-decoration: none;
  display: block;
`,R=e.exports.createContext({selectedSticker:[],refreshSticker:()=>Promise.resolve()}),q=(r,t)=>async()=>{const n=await r.board.selection.get();t(n.filter(y))},X=({children:r})=>{const t=v(),[n,o]=e.exports.useState([]);e.exports.useEffect(()=>{const i=q(t,o);return t.addListener("SELECTION_UPDATED",i),t.board.selection.get().then(c=>o(c.filter(y)||[])),()=>{t.removeListener("SELECTION_UPDATED",i)}},[t,o]);const s=e.exports.useMemo(()=>async()=>{const i=await t.board.selection.get();o(i.filter(y))},[t,o]);return e.exports.createElement(R.Provider,{value:{selectedSticker:n,refreshSticker:s}},r)},w=()=>e.exports.useContext(R),$=({setView:r})=>{const t=v(),{selectedSticker:n}=w(),[o,s]=e.exports.useState("2"),[i,c]=e.exports.useState(2),[a,l]=e.exports.useState(!1),[u,d]=e.exports.useState(""),[k,f]=e.exports.useState(),[x,S]=e.exports.useState(!1),N=async()=>{const m=K(n,i,k),C=await t.board.viewport.get(),T=C.y+E/2,U=C.x+E/2,F=V(m,U,T),M=await t.board.widgets.update(F);await t.board.selection.selectWidgets(M);const O=z(M);O&&await t.board.viewport.set(O)};return e.exports.createElement(e.exports.Fragment,null,e.exports.createElement("h2",null,e.exports.createElement(A,{href:"",onClick:m=>{m.preventDefault(),r("Overview")}},"Affinity Diagram Tools /"),"Create Random Stacks"),e.exports.createElement("p",{className:"p-small"},"Selected number of stickers with notes: ",n.length),e.exports.createElement("p",{className:"p-medium"},"In an interpretation session, each participant will be given a stack of random stickers, to help building the affinity map (see \u201CContextual Design (2nd Edition)\u201D by Karen Holtzblatt, p. 139)."),e.exports.createElement("p",{className:"p-medium"},"Use this screen to create random stack of stickers from your selection."),e.exports.createElement("div",{className:"form-group"+(a?" error":"")},e.exports.createElement("label",{htmlFor:"numberOfParticipants"},"Number of participants"),e.exports.createElement("input",{className:"input",id:"numberOfParticipants",value:o,type:"number",onChange:m=>{s(m.target.value)},onBlur:()=>{const m=parseInt(o);isNaN(m)||m<=0?l(!0):(l(!1),c(m))}}),a&&e.exports.createElement("div",{className:"status-text"},"Number of participants must be a number greater 0")),e.exports.createElement("div",{className:"form-group"+(x?" error":"")},e.exports.createElement("label",{htmlFor:"maxNumberOfStickers"},"Max. number of stickers per participant"),e.exports.createElement("p",{className:"p-small"},"Leave this field empty to distribute all available stickers"),e.exports.createElement("input",{className:"input",id:"maxNumberOfStickers",placeholder:!a&&n.length>0?Math.ceil(n.length/i).toString():"",value:u,onChange:m=>d(m.target.value),onBlur:()=>{const m=u!==void 0&&u!==""?parseInt(u):void 0;m!==void 0&&(isNaN(m)||m<=0)?S(!0):(S(!1),f(m))}}),x&&e.exports.createElement("div",{className:"status-text"},"Number of stickers must be a number greater 0")),e.exports.createElement("button",{className:"button button-primary",onClick:N,disabled:n.length===0||a||x},n.length===0?"No interview stickers selected":"Create random stacks"))},J=p.div`
  display: flex;
  flex-direction: column;
  height: 100%;
`,Q=p.div`
  display: flex;
  flex-direction: row;
`,Z=p.div`
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
`,ee=p.div`
  margin-top: 1rem;
`,te=p.div`
  max-height: 100%;
  overflow-y: auto;
`,re=p.div`
  background-color: #fff9b8;
  border-radius: 4px;
  padding: 0.5rem;
  margin-bottom: 1.5rem;
  margin-right: 0.5rem;
`,ne=p.div`
  display: grid;
  position: relative;
`,ae=p.textarea`
  margin: 0;
  padding: 0;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  border: none;
  line-height: 1.5;
`,se=p.span`
  background-color: lightblue;
`,oe=p.span``;p.div`
  display: flex;
`;const D=p.div`
  margin-top: var(--space-small);
  margin-bottom: var(--space-small);
`,ie=({warningMessage:r,action:t,setShowActions:n,setWarningMessage:o,sticker:s,stickerText:i})=>{const c=v(),{refreshSticker:a}=w();return e.exports.createElement(D,null,e.exports.createElement("p",{className:"p-medium"},r),e.exports.createElement("p",{className:"p-medium"},"Are you sure, that you want to do this?"),e.exports.createElement("button",{className:"button button-danger button-small",onClick:async()=>{const l=t==="UpdateSticker"?h(b({},s),{text:s.metadata[g].originalText}):h(b({},s),{metadata:{[g]:h(b({},s.metadata[g]),{originalText:i})}});await c.board.widgets.update(l),await a(),n(!1)}},t==="UpdateSticker"?"Yes, update the sticker":"Yes, update the note"),e.exports.createElement("button",{className:"button button-small button-secondary",onClick:()=>o(void 0)},"Cancel"))},ce=({sticker:r,stickerText:t,showSetAndRestoreActions:n,setEditStickerId:o})=>{const[s,i]=e.exports.useState(!1),[c,a]=e.exports.useState(),[l,u]=e.exports.useState("UpdateNote"),d=e.exports.createElement(Q,null,e.exports.createElement("button",{title:"Edit original note",className:"button-icon button-icon-small icon-edit",onClick:()=>o(r.id)}),n&&e.exports.createElement("button",{title:"Show more note sticker options",className:`button-icon button-icon-small ${s?"icon-close":"icon-more"}`,onClick:()=>{i(!s)}}));return s?e.exports.createElement(e.exports.Fragment,null,d,c?e.exports.createElement(ie,{warningMessage:c,action:l,sticker:r,setShowActions:i,setWarningMessage:a,stickerText:t}):e.exports.createElement(D,null,e.exports.createElement("button",{className:"button button-small button-secondary",onClick:()=>{u("UpdateNote"),a("This will update the original note with the current text from the sticker.")}},"Update note with sticker text \u2190"),e.exports.createElement("button",{className:"button button-small button-secondary",onClick:()=>{u("UpdateSticker"),a("The current sticker text will be overwritten with the original note.")}},"Update sticker with note text \u2192"))):d},le=({originalText:r,setEditStickerId:t,sticker:n})=>{const[o,s]=e.exports.useState(""),i=v(),{refreshSticker:c}=w();return e.exports.useEffect(()=>{s(r)},[r,s]),e.exports.useEffect(()=>{const a=l=>{l instanceof KeyboardEvent&&l.key.toLowerCase()=="escape"&&(s(r),t(void 0))};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[]),e.exports.createElement(ne,null,e.exports.createElement(ae,{className:"textarea",value:o,onChange:a=>s(a.target.value),autoFocus:!0,onKeyDown:a=>{a.key.toLowerCase()==="enter"&&(a.preventDefault(),a.currentTarget.blur())},onBlur:async()=>{if(t(void 0),o!==r){const a=h(b(b({},n),n.text===r?{text:o}:{}),{metadata:{[g]:h(b({},n.metadata[g]),{originalText:o})}});await i.board.widgets.update(a),await c()}}}),e.exports.createElement("div",null,r))},me=({setView:r})=>{const{selectedSticker:t}=w(),[n,o]=e.exports.useState();return e.exports.createElement(J,null,e.exports.createElement("div",{className:"cs1 ce12"},e.exports.createElement("h2",null,e.exports.createElement(A,{href:"",onClick:s=>{s.preventDefault(),r("Overview")}},"Affinity Diagram Tools /"),"View original interview notes")),e.exports.createElement(te,null,t.length>0?t.map(s=>{var d,k;const i=((d=s.metadata[g])==null?void 0:d.originalText)||"",c=i.split(/\b/),a=s.plainText||"",l=a.split(/\s*\b\s*/),u=a!==i;return e.exports.createElement("div",{key:s.id},e.exports.createElement(ee,null,e.exports.createElement(Z,null,e.exports.createElement("strong",null,(k=s.metadata[g])==null?void 0:k.minutesReference),e.exports.createElement(ce,{stickerText:a,sticker:s,setEditStickerId:o,showSetAndRestoreActions:u})),e.exports.createElement(re,{"data-testid":"sticker-"+s.id},n===s.id?e.exports.createElement(le,{sticker:s,originalText:i,setEditStickerId:o}):c.map((f,x)=>u?l.includes(f)?e.exports.createElement(se,{key:x},f):e.exports.createElement(oe,{key:x},f):e.exports.createElement("span",{key:x},f)))))}):e.exports.createElement("p",{className:"p-medium"},"No interview sticker selected")))},ue=(r,t)=>{switch(r){case"CreateRandomStacks":return e.exports.createElement($,{setView:t});case"ShowMinutesMetadata":return e.exports.createElement(me,{setView:t});default:return e.exports.createElement(_,{setView:t})}},pe=()=>{const[r,t]=e.exports.useState("Overview"),n=ue(r,t);return e.exports.createElement(X,null,n)};j.render(e.exports.createElement(pe,null),document.getElementById("root"));
